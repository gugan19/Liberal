function PaymentWindow(b){var a=this;this.options=b;this.sePayWinTimeStamp=null;this.iePayWinTimerStarted=0;this.iePayWinAmount=0;this.iepayTimeoutCounter=0;this.ePayStartTimer;this.ePayPollTimer;ePayCloseFunction=null;ePayCompletedFunction=null;ePayPreCompletedFunction=null;ePayDeclinedFunction=null;ePayFeeCalculatedFunction=null;this.buildOK=false;this.enableEvents=false;this.serverUrl="https://ssl.ditonlinebetalingssystem.dk/integration/ewindow";this.serverDomain="ssl.ditonlinebetalingssystem.dk";this.protocol="https";this.eventListener=function(c){a.onMessage(c,a)};this.open=function(){this.write();if(document.getElementById("epay_form")){this.iePayWinTimerStarted=0;this.iepayTimeoutCounter=0;if(window.addEventListener){window.addEventListener("message",a.eventListener,false);this.setRandomKey()}else{if(window.attachEvent){window.attachEvent("onmessage",a.eventListener);this.setRandomKey()}else{this.listenerStart()}}document.getElementById("epay_form").submit()}};this.write=function(){var e=document.createElement("form");e.setAttribute("method","post");e.setAttribute("id","epay_form");e.setAttribute("action",this.serverUrl+"/Default.aspx");e.setAttribute("target",this.getTarget());document.body.appendChild(e);var c=null;for(var d in this.options){c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("name",d);c.setAttribute("value",this.options[d]);e.appendChild(c)}c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("name","randomkey");c.setAttribute("id","_epay_timestamp");e.appendChild(c);if(this.enableEvents&&this.canUseEvents){c=document.createElement("input");c.setAttribute("type","hidden");c.setAttribute("name","activateevents");c.setAttribute("value","1");e.appendChild(c)}if(!this.buildOK){if(this.getTarget()=="epay_frame"){this.setIframe()}else{if(this.getTarget()=="_top"){this.setFullscreen()}else{this.setOverlay()}}}};this.getTarget=function(){switch(String(this.options.windowstate)){case"2":return"epay_frame";break;case"4":return"epay_frame";break;case"3":return"_top";break;default:return"epay_overlay"}};this.setIframe=function(){var c=document.createElement("iframe");c.setAttribute("src",this.serverUrl+"/LoadingPage.aspx");c.setAttribute("width",this.iframewidth);c.setAttribute("height",this.iframeheight);c.setAttribute("frameborder","0");c.setAttribute("name","epay_frame");c.setAttribute("id","epay_frame");c.setAttribute("allowTransparency","true");document.body.appendChild(c)};this.setOverlay=function(){var d=document.createElement("div");var e="epay_overlay";d.setAttribute("id",e);d.setAttribute("style","position: fixed; z-index: "+this.overlayindex+"; top: 0px; left: 0px; background: #"+this.background+"; width: 100%; height: 100%; opacity: ."+this.opacity+"; filter: alpha(opacity="+this.opacity+"); -moz-opacity: ."+this.opacity);document.body.appendChild(d);var f=document.createElement("div");f.setAttribute("id","epay_frame_container");var h=document.documentElement,c=document.body;f.setAttribute("style","position: absolute;  z-index: "+this.overlayindex+1+"; left: 50%; margin-left: -"+Math.round(this.iframewidth/2)+"px; margin-top: 10px; top:"+(h&&h.scrollTop||c&&c.scrollTop||0)+"px;");document.body.appendChild(f);var g=document.createElement("iframe");g.setAttribute("id","epay_frame");g.setAttribute("name","epay_overlay");g.setAttribute("frameborder","0");g.setAttribute("width",this.iframewidth);g.setAttribute("height",this.iframeheight);g.setAttribute("src","about:blank");g.setAttribute("allowTransparency","true");f.appendChild(g)};this.setFullscreen=function(){};this.build=function(){document.write('<iframe src="'+this.serverUrl+'/LoadingPage.aspx" width="'+this.iframewidth+'" height="'+this.iframeheight+'" frameborder="0" allowTransparency="true" name="epay_frame" id="epay_frame"></iframe>');this.buildOK=true};this.append=function(c){if(document.getElementById(c)==undefined){alert("Div with ID "+c+" could not be found")}else{document.getElementById(c).innerHTML='<iframe src="'+this.serverUrl+'/LoadingPage.aspx" width="'+this.iframewidth+'" height="'+this.iframeheight+'" frameborder="0" allowTransparency="true" name="epay_frame" id="epay_frame"></iframe>';this.buildOK=true}};this.insert=function(c){this.append(c)};this.on=function(d,c){if(d=="close"){this.ePayCloseFunction=c;this.enableEvents=true}if(d=="completed"){this.ePayCompletedFunction=c;this.enableEvents=true}if(d=="precompleted"){this.ePayPreCompletedFunction=c;this.enableEvents=true}if(d=="declined"){this.ePayDeclinedFunction=c;this.enableEvents=true}if(d=="feecalculated"){this.ePayFeeCalculatedFunction=c;this.enableEvents=true}};this.setRandomKey=function(){var c=new Date();this.sePayWinTimeStamp=c.getFullYear()+""+(c.getMonth()+1)+""+c.getDate()+""+c.getHours()+""+c.getMinutes()+""+c.getMilliseconds();document.getElementById("_epay_timestamp").value=this.sePayWinTimeStamp};this.onMessage=function(d,e){var c=d.data;n=c.split("?");if("domain" in d){if(d.domain!=e.serverDomain&&d.domain!="payment1.epay.eu"){return}}if("origin" in d){if(d.origin!=e.protocol+"://"+e.serverDomain&&d.origin!=e.protocol+"://payment1.epay.eu"){return}}if(n[0]=="close"){this.close();if(typeof e.ePayCloseFunction=="function"){a.ePayCloseFunction()}}if(n[0]=="completed"){if(typeof e.ePayCompletedFunction=="function"){a.ePayCompletedFunction(n[1])}}if(n[0]=="precompleted"){if(typeof e.ePayPreCompletedFunction=="function"){a.ePayPreCompletedFunction()}else{a.submit()}}if(n[0]=="declined"){if(typeof e.ePayDeclinedFunction=="function"){a.ePayDeclinedFunction()}}if(n[0]=="feecalculated"){if(typeof e.ePayFeeCalculatedFunction=="function"){a.ePayFeeCalculatedFunction(n[1])}}};this.listenerStart=function(){try{this.setRandomKey();if(this.iePayWinTimerStarted==0){this.iePayWinTimerStarted=1;clearTimeout(this.ePayStartTimer);clearTimeout(this.ePayPollTimer);this.ePayStartTimer=setTimeout(function(){a.listener()},15000)}}catch(c){alert(c)}};this.listener=function(){var f=document.getElementById("epay_form");var e="";if(f){try{this.iepayTimeoutCounter++;if(f.amount){this.iePayWinAmount=escape(f.amount.value)}if(f.orderid){e=escape(f.orderid.value)}if(f.declineurl){sDeclineURL=escape(f.declineurl.value)}if(f.currency){sCurrency=escape(f.currency.value)}var c=document.createElement("script");c.type="text/javascript";c.src=this.serverUrl+"/Poll.aspx?merchantnumber="+escape(f.merchantnumber.value)+"&orderid="+e+"&timestamp="+escape(this.sePayWinTimeStamp)+"&amount="+escape(this.iePayWinAmount)+"&currency="+sCurrency;document.body.appendChild(c);if(this.iepayTimeoutCounter<200){this.ePayPollTimer=setTimeout(function(){a.listener()},5000)}else{if(this.iepayTimeoutCounter<360){this.ePayPollTimer=setTimeout(function(){a.listener()},15000)}}}catch(d){alert(d)}}};this.submit=function(){var c=document.getElementById("epay_frame").contentWindow;c.postMessage("submit","https://"+this.serverDomain)};this.close=function(){if(document.getElementById("epay_overlay")){document.body.removeChild(document.getElementById("epay_overlay"))}if(document.getElementById("epay_frame_container")){document.body.removeChild(document.getElementById("epay_frame_container"))}if(document.getElementById("epay_form")){document.body.removeChild(document.getElementById("epay_form"))}if(window.attachEvent){window.detachEvent("onmessage",a.eventListener)}if(window.addEventListener){window.removeEventListener("message",a.eventListener,false)}};if(b.iframeheight!=null){this.iframeheight=b.iframeheight}else{this.iframeheight="780"}if(b.iframewidth!=null){this.iframewidth=b.iframewidth}else{this.iframewidth="778"}if(b.opacity!=null){this.opacity=b.opacity}else{this.opacity="50"}if(b.backgroundcolor!=null){this.background=b.backgroundcolor}else{this.background="a7a7a7"}if(b.overlayindex!=null){this.overlayindex=b.overlayindex}else{this.overlayindex="1000"}IE6=(navigator.appVersion.indexOf("MSIE 6.")==-1)?false:true;if(IE6==true&&(String(b.windowstate)=="1"||b.windowstate==undefined)){b.windowstate="3"}IE7=(navigator.appVersion.indexOf("MSIE 7.")==-1)?false:true;if(IE7==true&&(String(b.windowstate)=="1"||b.windowstate==undefined)){b.windowstate="3"}this.canUseEvents=(IE6||IE7||(!window.addEventListener&&!window.attachEvent))?false:true}if(typeof PaymentWindowReady==="function"){PaymentWindowReady()};